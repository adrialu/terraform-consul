---
# Handles base package setup:
- name: Installing base packages
  apt:
    # Install a set of packages with latest version, update cache at the same time
    name: "{{ packages }}"
    state: latest
    update_cache: yes
  vars:
    # Add vim,tmux,htop just to demonstrate
    packages:
      - vim
      - tmux
      - htop
      - unzip
  become: yes

# Handles timezone setup (NTP package might be overkill?)
- name: Set timezone to Europe/Oslo
  timezone:
    name: Europe/Oslo
  become: yes

# Copy custom .vimrc
- name: Add vimrc
  template:
    src: vimrc.tpl
    dest: /home/ubuntu/.vimrc
    owner: ubuntu
    group: ubuntu
    mode: 0664

# Copy custom .bashrc
- name: Add bashrc
  template:
    src: bashrc.tpl
    dest: /home/ubuntu/.bashrc
    owner: ubuntu
    group: ubuntu
    mode: 0644

- name: Get and unzip consul
  unarchive:
    src: https://releases.hashicorp.com/consul/{{ consul_version }}/consul_{{ consul_version }}_linux_amd64.zip
    dest: /usr/local/bin
    mode: 0755
    owner: root
    group: root
    remote_src: yes
  become: yes

- name: Config consul service
  template:
    src: consul.service.tpl
    dest: /etc/systemd/system/consul.service
    owner: root
    group: root
    mode: 0644
  become: yes
  notify: reload_consul_service
